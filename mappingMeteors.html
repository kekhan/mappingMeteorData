<!DOCTYPE html>
<html>
    <head>
    	<title>Mapping Meteors Across the Globe</title>
        <style type="text/css">
        body{
            background-color: #0845E8;
        }
        tspan{
            font-size: 1rem;
            position: absolute;
            background-color: red; 

        }
        h1{
            color:white;
            text-align: center;
        }
        </style>
    </head>
    <body>

    	<div id ="wrapper">
            <h1>Meteors Across the Globe</h1>
        </div>
    	<script src = "http://d3js.org/d3.v3.min.js"></script>
    	<script type="text/javascript">
    	    var url = "https://raw.githubusercontent.com/FreeCodeCamp/ProjectReferenceData/master/meteorite-strike-data.json";

    	    var width = 800;
    	    var height = 900;
    	    var padding = 50;
    	    var margin = 50;
            var aProjection = d3.geo.mercator()
                .scale(150)
                .translate([width / 2, height / 2]);
            var geoPath = d3.geo.path().projection(aProjection);

            // svg is box where data is displayed
    	    var svg = d3.selectAll("#wrapper")
    	                .append('svg')
    	                .attr('width',width + padding + margin)
    	                .attr('height',height + padding + margin)
    	                .append('g')
    	                .attr('transforn','translate('+ padding +','+ margin +')');

            var geoUrl = "http://emeeks.github.io/d3ia/world.geojson";

            // below json is the map
            d3.json(geoUrl,function createMap(map){
                    svg.selectAll("path")
                    .data(map.features)
                    .enter()
                    .append("path")
                    .attr("d", geoPath)
                    .attr("class", "map")
                    .style("fill", "gray");
                    
            });


            // below d3.json parses data of meteors
            d3.json(url,function(json){
                    dots = svg.selectAll('g.dots')
                        
                        .data(json.features)
                        .enter()
                        .append('g')
                        .attr('class','circle');
                      
                    dots.append("circle")
                        .attr("cx",function(d){
                            return aProjection([d.properties.reclong,d.properties.reclat])[0];
                        })
                        .attr("cy",function(d){
                            return aProjection([d.properties.reclong,d.properties.reclat])[1];
                        })
                        .attr("r","3px")
                        .attr("fill","black");
                        


                    // text message of information need tspan to show in blocks
                    var textOut = dots.append("text")
                        .style('text-anchor','start')
                        .style('background-color','red')
                        .attr("x", function(d) { return aProjection([d.properties.reclong,d.properties.reclat])[0]; })
                        .attr("y", function(d) { return aProjection([d.properties.reclong,d.properties.reclat])[1]; });
                        
                        textOut.append('tspan')
                        .text(function(d,i){
                            //console.log(d);
                            var message = "Fall:"+ d.properties.fall;/* + "\n"+ "Meteor Name:" + d.properties.name + "\n"+ "year: " +  d.properties.year;
                            console.log(message);*/
                            return message;

                         }) 
                        .attr("x", function(d) { return aProjection([d.properties.reclong,d.properties.reclat])[0]; })
                        .style('display','none');
                        textOut.append('tspan')
                        .text(function(d,i){
                            return "Mass:" + d.properties.mass + "kg";
                        })
                        .attr("x", function(d) { return aProjection([d.properties.reclong,d.properties.reclat])[0]; })
                        .attr("y", function(d) { return aProjection([d.properties.reclong,d.properties.reclat])[1] +20; })
                        //.style('text-anchor','middle')
                        .style('background','red')
                        .style('display','none');

                        textOut.append('tspan')// tspan helps break text on newline
                        .text(function(d,i){
                            return "Name:" + d.properties.name;
                        })
                        .attr("x", function(d) { return aProjection([d.properties.reclong,d.properties.reclat])[0]; })
                        .attr("y", function(d) { return aProjection([d.properties.reclong,d.properties.reclat])[1] +40; })
                        .style('display','none');
                        textOut.append('tspan')
                        
                        .text(function(d,i){
                            return "year:" +  d.properties.year;
                        })
                        .attr("x", function(d) { return aProjection([d.properties.reclong,d.properties.reclat])[0]; })
                        .attr("y", function(d) { return aProjection([d.properties.reclong,d.properties.reclat])[1] +60; })
                        .style('display','none');

           

                    // tooltip on dot will show message with information
                    dots.on("mouseenter",function(d,i){
                        console.log("mouse on");
                        dot = d3.select(this);
                        dot.selectAll('tspan') 
                            //.select('tspan')
                            .style('fill','white')
                            .style("display","block");
                    });


                    // message will stop displaying when tooltip moves away
                    dots.on("mouseleave",function(d,i){
                        //console.log("mouse out");
                        d3.select(this)

                            .selectAll('tspan')
                            //.select('tspan')
                            .style('fill','white')
                            .style('display','none');
                    })

            });


    	</script>
    </body>
</html>